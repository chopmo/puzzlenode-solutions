Really unhappy about this one, to be honest. Much too complicated design, and when I grew tired of working on it I just wanted to get it done, leaving some pretty messy code behind. 

I should have made a quick'n'dirty solution here, because it is not complicated enough to warrant a full OO design. 